---
id: StoragePersister
title: StoragePersister
---

<!-- DO NOT EDIT: this page is autogenerated from the type comments -->

# Class: StoragePersister\<TState, TSelected\>

Defined in: storage-persister.ts:143

A persister that saves state to browser local/session storage.

The persister can use either localStorage (persists across browser sessions) or
sessionStorage (cleared when browser tab/window closes). State is automatically
serialized to JSON when saving and deserialized when loading.

Optionally, a `buster` string can be provided to force cache busting by storing it in the value.
Optionally, a `maxAge` (in ms) can be provided to expire the stored state after a certain duration.
Optionally, callbacks can be provided to run after state is saved or loaded.

## Example

```ts
const persister = new StoragePersister({
  key: 'my-rate-limiter', // required
  storage: window.localStorage,
  buster: 'v2',
  maxAge: 1000 * 60 * 60, // 1 hour
  stateTransform: (state) => ({
    // Only persist specific parts of the state
    count: state.count,
    lastReset: state.lastReset,
    // Exclude sensitive or temporary data
  }),
  onSaveState: (key, state) => console.log('State saved:', key, state),
  onLoadState: (key, state) => console.log('State loaded:', key, state),
  onLoadStateError: (key, error) => console.error('Error loading state:', key, error),
  onSaveStateError: (key, error) => console.error('Error saving state:', key, error)
})
```

## Extends

- [`Persister`](../persister.md)\<`TState`, `TSelected`\>

## Type Parameters

• **TState**

• **TSelected** *extends* `Partial`\<`TState`\> = `TState`

## Constructors

### new StoragePersister()

```ts
new StoragePersister<TState, TSelected>(initialOptions): StoragePersister<TState, TSelected>
```

Defined in: storage-persister.ts:149

#### Parameters

##### initialOptions

[`StoragePersisterOptions`](../../interfaces/storagepersisteroptions.md)\<`TState`, `TSelected`\>

#### Returns

[`StoragePersister`](../storagepersister.md)\<`TState`, `TSelected`\>

#### Overrides

[`Persister`](../persister.md).[`constructor`](../Persister.md#constructors)

## Properties

### key

```ts
readonly key: string;
```

Defined in: persister.ts:31

#### Inherited from

[`Persister`](../persister.md).[`key`](../Persister.md#key-1)

***

### options

```ts
options: StoragePersisterOptions<TState, TSelected> & Required<Pick<Partial<StoragePersisterOptions<any, any>>, "deserializer" | "serializer" | "storage">> & Omit<Partial<StoragePersisterOptions<any, any>>, "deserializer" | "serializer" | "storage">;
```

Defined in: storage-persister.ts:147

## Methods

### clearState()

```ts
clearState(useDefaultState): void
```

Defined in: storage-persister.ts:258

Clears the state from storage or sets the default state if provided and specified to be used

#### Parameters

##### useDefaultState

`boolean` = `false`

#### Returns

`void`

#### Overrides

```ts
Persister.clearState
```

***

### loadState()

```ts
loadState(): undefined | TSelected
```

Defined in: storage-persister.ts:193

Loads the state from storage

#### Returns

`undefined` \| `TSelected`

#### Overrides

```ts
Persister.loadState
```

***

### saveState()

```ts
saveState(state): void
```

Defined in: storage-persister.ts:169

Saves the state to storage

#### Parameters

##### state

`TState` | `TSelected`

#### Returns

`void`

#### Overrides

```ts
Persister.saveState
```

***

### setOptions()

```ts
setOptions(newOptions): void
```

Defined in: storage-persister.ts:160

Updates the persister options

#### Parameters

##### newOptions

`Partial`\<[`StoragePersisterOptions`](../../interfaces/storagepersisteroptions.md)\<`TState`, `TSelected`\>\>

#### Returns

`void`

***

### subscribeToStorage()

```ts
subscribeToStorage(): void
```

Defined in: storage-persister.ts:245

#### Returns

`void`

***

### unsubscribeFromStorage()

```ts
unsubscribeFromStorage(): void
```

Defined in: storage-persister.ts:250

#### Returns

`void`
