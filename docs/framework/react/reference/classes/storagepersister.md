---
id: StoragePersister
title: StoragePersister
---

<!-- DO NOT EDIT: this page is autogenerated from the type comments -->

# Class: StoragePersister\<TState, TSelected\>

Defined in: persister/dist/esm/storage-persister.d.ts:112

A persister that saves state to browser local/session storage.

The persister can use either localStorage (persists across browser sessions) or
sessionStorage (cleared when browser tab/window closes). State is automatically
serialized to JSON when saving and deserialized when loading.

Optionally, a `buster` string can be provided to force cache busting by storing it in the value.
Optionally, a `maxAge` (in ms) can be provided to expire the stored state after a certain duration.
Optionally, callbacks can be provided to run after state is saved or loaded.

## Example

```ts
const persister = new StoragePersister({
  key: 'my-rate-limiter', // required
  storage: window.localStorage,
  buster: 'v2',
  maxAge: 1000 * 60 * 60, // 1 hour
  stateTransform: (state) => ({
    // Only persist specific parts of the state
    count: state.count,
    lastReset: state.lastReset,
    // Exclude sensitive or temporary data
  }),
  onSaveState: (key, state) => console.log('State saved:', key, state),
  onLoadState: (key, state) => console.log('State loaded:', key, state),
  onLoadStateError: (key, error) => console.error('Error loading state:', key, error),
  onSaveStateError: (key, error) => console.error('Error saving state:', key, error)
})
```

## Extends

- [`Persister`](../persister.md)\<`TState`, `TSelected`\>

## Type Parameters

• **TState**

• **TSelected** *extends* `Partial`\<`TState`\> = `TState`

## Constructors

### new StoragePersister()

```ts
new StoragePersister<TState, TSelected>(initialOptions): StoragePersister<TState, TSelected>
```

Defined in: persister/dist/esm/storage-persister.d.ts:114

#### Parameters

##### initialOptions

[`StoragePersisterOptions`](../../interfaces/storagepersisteroptions.md)\<`TState`, `TSelected`\>

#### Returns

[`StoragePersister`](../storagepersister.md)\<`TState`, `TSelected`\>

#### Overrides

[`Persister`](../persister.md).[`constructor`](../Persister.md#constructors)

## Properties

### clearState()

```ts
clearState: (useDefaultState?) => void;
```

Defined in: persister/dist/esm/storage-persister.d.ts:140

Clears the state from storage or sets the default state if provided and specified to be used

#### Parameters

##### useDefaultState?

`boolean`

#### Returns

`void`

#### Overrides

[`Persister`](../persister.md).[`clearState`](../Persister.md#clearstate)

***

### key

```ts
readonly key: string;
```

Defined in: persister/dist/esm/persister.d.ts:28

#### Inherited from

[`Persister`](../persister.md).[`key`](../Persister.md#key-1)

***

### loadState()

```ts
loadState: () => undefined | TSelected;
```

Defined in: persister/dist/esm/storage-persister.d.ts:126

Loads the state from storage

#### Returns

`undefined` \| `TSelected`

#### Overrides

[`Persister`](../persister.md).[`loadState`](../Persister.md#loadstate)

***

### options

```ts
options: StoragePersisterOptions<TState, TSelected> & Required<Pick<Partial<StoragePersisterOptions<any, any>>, "deserializer" | "serializer" | "storage">> & Omit<Partial<StoragePersisterOptions<any, any>>, "deserializer" | "serializer" | "storage">;
```

Defined in: persister/dist/esm/storage-persister.d.ts:113

***

### saveState()

```ts
saveState: (state) => void;
```

Defined in: persister/dist/esm/storage-persister.d.ts:122

Saves the state to storage

#### Parameters

##### state

`TState` | `TSelected`

#### Returns

`void`

#### Overrides

[`Persister`](../persister.md).[`saveState`](../Persister.md#savestate)

***

### setOptions()

```ts
setOptions: (newOptions) => void;
```

Defined in: persister/dist/esm/storage-persister.d.ts:118

Updates the persister options

#### Parameters

##### newOptions

`Partial`\<[`StoragePersisterOptions`](../../interfaces/storagepersisteroptions.md)\<`TState`, `TSelected`\>\>

#### Returns

`void`

***

### subscribeToStorage()

```ts
subscribeToStorage: () => void;
```

Defined in: persister/dist/esm/storage-persister.d.ts:135

#### Returns

`void`

***

### unsubscribeFromStorage()

```ts
unsubscribeFromStorage: () => void;
```

Defined in: persister/dist/esm/storage-persister.d.ts:136

#### Returns

`void`
